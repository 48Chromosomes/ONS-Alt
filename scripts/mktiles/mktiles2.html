<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8"/>
  <style>
    table.head, table.foot { width: 100%; }
    td.head-rtitle, td.foot-os { text-align: right; }
    td.head-vol { text-align: center; }
    .Nd, .Bf, .Op { display: inline; }
    .Pa, .Ad { font-style: italic; }
    .Ms { font-weight: bold; }
    .Bl-diag > dt { font-weight: bold; }
    code.Nm, .Fl, .Cm, .Ic, code.In, .Fd, .Fn, .Cd { font-weight: bold;
      font-family: inherit; }
  </style>
  <title>mktiles2(1)</title>
</head>
<body>
<table class="head">
  <tr>
    <td class="head-ltitle">mktiles2(1)</td>
    <td class="head-vol">General Commands Manual</td>
    <td class="head-rtitle">mktiles2(1)</td>
  </tr>
</table>
<div class="manual-text">
<section class="Sh">
<h1 class="Sh" id="NAME"><a class="permalink" href="#NAME">NAME</a></h1>
<p class="Pp"><code class="Nm">mktiles2</code> &#x2014;
    <span class="Nd">generate Census Atlas data files</span></p>
</section>
<section class="Sh">
<h1 class="Sh" id="SYNOPSIS"><a class="permalink" href="#SYNOPSIS">SYNOPSIS</a></h1>
<table class="Nm">
  <tr>
    <td><code class="Nm">mktiles2</code></td>
    <td>[<code class="Fl">-c</code> <var class="Ar">content.json</var>]
      [<code class="Fl">-C</code> <var class="Ar">classcode</var>]
      [<code class="Fl">-M</code>] [<code class="Fl">-P</code>
      <var class="Ar">prefix</var>] [<code class="Fl">-I</code>
      <var class="Ar">indir</var>] [<code class="Fl">-F</code>]
      [<code class="Fl">-R</code>] [<code class="Fl">-i</code>]
      [<code class="Fl">-O</code> <var class="Ar">outdir</var>]
      [<code class="Fl">-f</code>]</td>
  </tr>
</table>
</section>
<section class="Sh">
<h1 class="Sh" id="DESCRIPTION"><a class="permalink" href="#DESCRIPTION">DESCRIPTION</a></h1>
<p class="Pp"><code class="Nm">mktiles2</code> generates data files used by the
    Census Atlas web application. It loads census metrics, geographic data, and
    control files, then produces a set of files containing data in a structure
    usable by the Census Atlas. <code class="Nm">mktiles2</code> recognises the
    following flags:</p>
<dl class="Bl-tag">
  <dt id="c"><a class="permalink" href="#c"><code class="Fl">-c</code></a>
    <var class="Ar">content.json</var></dt>
  <dd>Path to the <span class="Pa">content.json</span> file. This defaults to
      <var class="Ar">outdir</var>/<code class="Li">content.json</code>.</dd>
  <dt id="C"><a class="permalink" href="#C"><code class="Fl">-C</code></a>
    <var class="Ar">classcode</var></dt>
  <dd>Only use categories in <span class="Pa">content.json</span> that are under
      the classification <var class="Ar">classcode</var>. Normally all
      categories in under all classifications
      <span class="Pa">content.json</span> will be used.
    <p class="Pp">Use this flag when category codes are duplicated in different
        classifications.</p>
  </dd>
  <dt id="M"><a class="permalink" href="#M"><code class="Fl">-M</code></a></dt>
  <dd>Match categories from input files based on name rather than code.
    <p class="Pp">Categories are selected from metrics input files when their
        column headings string match category codes in
        <span class="Pa">content.json</span>. When <code class="Fl">-M</code> is
        used, categories will be selected when their column headings match
        category names instead.</p>
  </dd>
  <dt id="P"><a class="permalink" href="#P"><code class="Fl">-P</code></a>
    <var class="Ar">prefix</var></dt>
  <dd>When <code class="Fl">-M</code> is used, <var class="Ar">prefix</var> is
      prepended to category names found in <span class="Pa">content.json</span>
      and then the prefix+catcode combination is matched against column headings
      in the metrics files.
    <p class="Pp">For example, the column headings in the metrics file might be
        like this &#x2018;<code class="Li">2021 Value change: Household is not
        deprived in any dimension</code>&#x2019;, where they are prefixed with
        &#x2018;<code class="Li">2021 Value change: </code>&#x2019;. If
        <span class="Pa">content.json</span> only names
        &#x2018;<code class="Li">Household is not deprived in any
        dimension</code>&#x2019;, without the prefix, you can match these
        categories by providing a prefix to add to category names found in
        <span class="Pa">content.json</span>.</p>
  </dd>
  <dt id="II"><a class="permalink" href="#II"><code class="Fl">-II</code></a>
    <var class="Ar">indir</var></dt>
  <dd>Read input files from <var class="Ar">indir</var>. Defaults to
      <span class="Pa">./in/</span>. See below for the structure of the input
      directory.</dd>
  <dt id="F"><a class="permalink" href="#F"><code class="Fl">-F</code></a></dt>
  <dd>Generate fake metrics. Instead of reading metrics files, generate random
      values. Values will be produced for all geographies in the loaded geojson
      files against all the categories found in
      <span class="Pa">content.json</span>.</dd>
  <dt id="R"><a class="permalink" href="#R"><code class="Fl">-R</code></a></dt>
  <dd>Produce ratios instead of metrics values. See
      <a class="Sx" href="#Calculating_Ratios">Calculating Ratios</a> below for
      how ratios are calculated.</dd>
  <dt id="i"><a class="permalink" href="#i"><code class="Fl">-i</code></a></dt>
  <dd>Ignore missing categories in metrics files. Normally it is an error if a
      category is named in <span class="Pa">content.json</span> but not found in
      any metrics files. With <code class="Fl">-i</code> missing values will
      just be omitted from the output files. (If there is no category data for
      any of the geos for a tile, no data tile will be produced at all.)</dd>
  <dt id="O"><a class="permalink" href="#O"><code class="Fl">-O</code></a>
    <var class="Ar">outdir</var></dt>
  <dd>Output directory. Defaults to <span class="Pa">./out/</span>. This
      directory will be created if it doesn't exist. See below for the structure
      of the output directory.</dd>
  <dt id="f"><a class="permalink" href="#f"><code class="Fl">-f</code></a></dt>
  <dd>Force using an existing output directory even if it already has content.
      Normally it is an error if the output directory already contains any files
      or directories.</dd>
</dl>
<section class="Ss">
<h2 class="Ss" id="Contents_of_the_input_directory"><a class="permalink" href="#Contents_of_the_input_directory">Contents
  of the input directory</a></h2>
<p class="Pp"><code class="Nm">mktiles2</code> expects the input directory
    <var class="Ar">indir</var> to contain a number of files.</p>
<dl class="Bl-tag">
  <dt>Grid file</dt>
  <dd>The grid file <span class="Pa">DataTileGrid.json</span> describes output
      tiles covering geographic areas. Features in geojson files which overlap
      these tiles will be included in the corresponding output data tiles. Each
      tile has a name and a bounding box, and tiles are grouped by level (LAD,
      LSOA, MSOA, OA). Here is an example snippet of a
      <span class="Pa">DataTileGrid.json</span> file:
    <div class="Bd Pp Bd-indent">
    <pre>
{
  &quot;lad&quot;: [
    {
      &quot;tilename&quot;: &quot;ew&quot;,
      &quot;bbox&quot;: {
        &quot;east&quot;: 1.76,
        &quot;north&quot;: 58.64,
        &quot;west&quot;: -7.57,
        &quot;south&quot;: 49.92
      }
    }
  ],
  &quot;msoa&quot;: [
    {
      &quot;tilename&quot;: &quot;61-43-7&quot;,
      &quot;bbox&quot;: {
        &quot;east&quot;: -5.625,
        &quot;north&quot;: 50.73645513701065,
        &quot;west&quot;: -8.4375,
        &quot;south&quot;: 48.922499263758255
      }
    },
  . . .
    </pre>
    </div>
    <p class="Pp">Recognised geography levels are
        &#x2018;<code class="Li">lad</code>&#x2019;,
        &#x2018;<code class="Li">lsoa</code>&#x2019;,
        &#x2018;<code class="Li">msoa</code>&#x2019;, and
        &#x2018;<code class="Li">oa</code>&#x2019;. The
        <var class="Va">bbox</var> values are latitude and longitude.</p>
    <p class="Pp">In the example above, features within
        <span class="Pa">msoa.geojson</span> which overlap the bounding box of
        MSOA tile &#x2018;<code class="Li">61-43-7</code>&#x2019; will be
        included in
        <span class="Pa">tiles/msoa/61-43-7/</span><var class="Va">category</var>.csv.
        (See a full description of the output directory structure below.)</p>
  </dd>
  <dt>geojson files</dt>
  <dd><code class="Nm">mktiles2</code> expects at least one of the following
      geojson files to exist in <var class="Ar">indir</var>:
    <p class="Pp"></p>
    <div class="Bd-indent">
    <dl class="Bl-tag Bl-compact">
      <dt>lad.geojson</dt>
      <dd style="width: auto;">&#x00A0;</dd>
      <dt>lsoa.geojson</dt>
      <dd style="width: auto;">&#x00A0;</dd>
      <dt>msoa.geojson</dt>
      <dd style="width: auto;">&#x00A0;</dd>
      <dt>oa.geojson</dt>
      <dd style="width: auto;">&#x00A0;</dd>
    </dl>
    </div>
    <p class="Pp">These are standard geojson files. The name of the geojson
        files indicates the geographic level of features within the file. All
        features in <span class="Pa">oa.geojson</span> will be considered OAs,
        for example.</p>
    <p class="Pp">Each feature is expected to have certain standard properties
        indicating its geography code and place name. The expected properties
        vary by geographic level.</p>
    <p class="Pp">The table below show which properties are required. Where
        multiple property names are shown, only one is needed. For example, only
        one of &#x2018;<code class="Li">lad11nm</code>&#x2019;,
        &#x2018;<code class="Li">lad17nm</code>&#x2019;, or
        &#x2018;<code class="Li">lad21nm</code>&#x2019; is needed to convey the
        English place name for features in <span class="Pa">lad.geojson</span>.
        Property names are case-insensitive.</p>
    <table class="Bl-column Bd-indent">
      <tr>
        <td>Geographic</td>
        <td></td>
        <td>English</td>
        <td>Welsh</td>
      </tr>
      <tr>
        <td>level</td>
        <td>geocode</td>
        <td>name</td>
        <td>name</td>
      </tr>
      <tr>
        <td>----------</td>
        <td>-------</td>
        <td>--------</td>
        <td>---------</td>
      </tr>
      <tr>
        <td>LAD</td>
        <td>lad11cd</td>
        <td>lad11nm</td>
        <td>lad11nmw</td>
      </tr>
      <tr>
        <td></td>
        <td>lad17cd</td>
        <td>lad17nm</td>
        <td>lad17nmw</td>
      </tr>
      <tr>
        <td></td>
        <td>lad21cd</td>
        <td>lad21nm</td>
        <td>lad21nmw</td>
      </tr>
      <tr>
        <td></td>
        <td></td>
        <td></td>
        <td></td>
      </tr>
      <tr>
        <td>LSOA</td>
        <td>lsoa11cd</td>
        <td>lsoa11nm</td>
        <td>lsoa11nmw</td>
      </tr>
      <tr>
        <td></td>
        <td>lsoa21cd</td>
        <td>lsoa21nm</td>
        <td>lsoa21nmw</td>
      </tr>
      <tr>
        <td></td>
        <td></td>
        <td></td>
        <td></td>
      </tr>
      <tr>
        <td>MSOA</td>
        <td>msoa11cd</td>
        <td>msoa11nm</td>
        <td>msoa11nmw</td>
      </tr>
      <tr>
        <td></td>
        <td>msoa21cd</td>
        <td>msoa21nm</td>
        <td>msoa21nmw</td>
      </tr>
      <tr>
        <td></td>
        <td></td>
        <td></td>
        <td></td>
      </tr>
      <tr>
        <td>OA</td>
        <td>oa11cd</td>
        <td>oa11nm</td>
        <td>oa11nmw</td>
      </tr>
      <tr>
        <td></td>
        <td>oa21cd</td>
        <td>oa21nm</td>
        <td>oa21nmw</td>
      </tr>
    </table>
    <p class="Pp">Here is an example snippet showing a feature's properties.
        This is part of a <span class="Pa">lad.geojson</span> file. The
        geographic code is &#x2018;<code class="Li">E06000001</code>&#x2019;,
        and the English place name is
        &#x2018;<code class="Li">Hartlepool</code>&#x2019;. There isn't a Welsh
        place name, but there is a blank property.</p>
    <div class="Bd Pp Bd-indent">
    <pre>
{
  &quot;type&quot;: &quot;Feature&quot;,
  &quot;properties&quot;: {
    &quot;OBJECTID&quot;: 1,
    &quot;LAD21CD&quot;: &quot;E06000001&quot;,
    &quot;LAD21NM&quot;: &quot;Hartlepool&quot;,
    &quot;LAD21NMW&quot;: &quot; &quot;,
    &quot;BNG_E&quot;: 447160,
    &quot;BNG_N&quot;: 531474,
    &quot;LONG&quot;: -1.27018,
    &quot;LAT&quot;: 54.67614,
    &quot;GlobalID&quot;: &quot;{A0067727-6C25-4D75-BBE3-839CF676A069}&quot;,
    &quot;SHAPE_Length&quot;: 0.8685706369282687,
    &quot;SHAPE_Area&quot;: 0.013064964649121342
  },
  &quot;geometry&quot;: {
    &quot;type&quot;: &quot;MultiPolygon&quot;,
  . . .
    </pre>
    </div>
    <p class="Pp">See <a class="Sx" href="#SEE_ALSO">SEE ALSO</a> below for how
        to download geojson files from the Open Geography Portal.</p>
  </dd>
  <dt>MSOA names (optional)</dt>
  <dd>The place names in <span class="Pa">msoa.geojson</span> as downloaded from
      the Open Geography Portal (see <a class="Sx" href="#SEE_ALSO">SEE ALSO</a>
      below) are technical names and not necessarily common names. You can
      supply a mapping file to change the names to more common ones.
    <p class="Pp">The mapping file is a CSV with headers indicating the MSOA
        geography code and common names. In this mapping file, the columns may
        be in any order, and there may be extra columns which will be
      ignored.</p>
    <p class="Pp">This table shows which columns convey which information:</p>
    <table class="Bl-column Bd-indent">
      <tr>
        <td>Data</td>
        <td>CSV header</td>
      </tr>
      <tr>
        <td>-------------------</td>
        <td>----------------------------</td>
      </tr>
      <tr>
        <td>Geography code</td>
        <td>msoa11cd or msoa21cd</td>
      </tr>
      <tr>
        <td>English common name</td>
        <td>msoa11hclnm or msoa21hclnm</td>
      </tr>
      <tr>
        <td>Welsh common name</td>
        <td>msoa11hclnmw or msoa21hclnmw</td>
      </tr>
    </table>
    <p class="Pp">For example, below are the first two lines of an MSOA names
        file. The first, fourth and fifth columns will be used to match common
        names to geography codes, and the rest of the columns will be
      ignored.</p>
    <div class="Bd Pp">
    <pre>
msoa21cd,msoa21nm,msoa21nmw,msoa21hclnm,msoa21hclnmw,localauthorityname,type
E02006534,Adur 001,Adur 001,Hillside,,Adur,Present in 2011
    </pre>
    </div>
    <p class="Pp">See <a class="Sx" href="#SEE_ALSO">SEE ALSO</a> below for a
        link to the House of Commons Library MSOA Names page where you can
        download <span class="Pa">msoa-names.csv</span>.</p>
  </dd>
  <dt>LAD recodes (optional)</dt>
  <dd>Sometimes the geography codes in <span class="Pa">lad.geojson</span> need
      to be mapped to different codes. In these cases, create
      <span class="Pa">recode-lads.csv</span> to map old codes to new ones. This
      file should have a header line, and then a line for each recode, like
      this:
    <div class="Bd Pp Bd-indent">
    <pre>
FromCode,ToCode
E06000057,E06000048
    </pre>
    </div>
    <p class="Pp">In that example, when a feature with the geography code
        &#x2018;<code class="Li">E06000057</code>&#x2019; is loaded, its
        geography code will be changed to
        &#x2018;<code class="Li">E06000048</code>&#x2019;, and metrics will
        match against &#x2018;<code class="Li">E06000048</code>&#x2019;.</p>
  </dd>
  <dt>content.json (may be elsewhere)</dt>
  <dd>The <span class="Pa">content.json</span> file contains the categories that
      will be included in the output files. This file is used by the Census Maps
      application, so it has a lot more information than just categories.
      Categories (or category names) in this file are matched against category
      headings in metrics CSV files.
    <p class="Pp">There have been three versions of this file as Census Maps has
        developed. They differ in how deep the classification/category objects
        are nested. The main thing to know is that the classification/category
        relationship looks like this:</p>
    <div class="Bd Pp Bd-indent">
    <pre>
&quot;classifications&quot;: [
  &quot;code&quot;: &quot;classification code&quot;,
  &quot;categories&quot;: [
    {
      &quot;name&quot;: &quot;category name&quot;,
      &quot;code&quot;: &quot;category code&quot;,
    }
  ]
]
    </pre>
    </div>
    <p class="Pp">Depending on <code class="Fl">-M</code>, either the category
        code or category name is matched against headings in metrics files. And
        when <code class="Fl">-C</code> <var class="Ar">classcode</var> is used,
        only categories within the classification code matching
        <var class="Ar">classcode</var> will be used.</p>
  </dd>
  <dt>Metrics files</dt>
  <dd>All <span class="Pa">.csv</span> files in <var class="Ar">indir</var>,
      except for <span class="Pa">msoa-names.csv</span> are loaded as metrics
      files. These are CSV files with headers, the first of which must be
      &#x2018;<code class="Li">GeographyCode</code>&#x2019;. All other columns
      may be matched to category codes or names from
      <span class="Pa">content.json</span>, although any unreferenced columns
      are ignored.
    <p class="Pp">The &#x2018;<code class="Li">GeographyCode</code>&#x2019;
        column name is case-insensitive, and may include spaces, as in
        &#x2018;<code class="Li">geography code</code>&#x2019;, and so on.</p>
    <p class="Pp">Each line contains metrics for a single geography, whose code
        is in the first column. Here is an example:</p>
    <div class="Bd Pp Bd-indent">
    <pre>
GeographyCode,category1,category2
E06000057,0.5,0.75
    </pre>
    </div>
  </dd>
</dl>
</section>
<section class="Ss">
<h2 class="Ss" id="Structure_of_the_output_directory"><a class="permalink" href="#Structure_of_the_output_directory">Structure
  of the output directory</a></h2>
<p class="Pp"><code class="Nm">mktiles2</code> produces a directory structure
    under <var class="Ar">outdir</var> like this:</p>
<dl class="Bl-tag">
  <dt>tiles (directory)</dt>
  <dd>The <span class="Pa">tiles</span> directory holds &quot;data tiles&quot;.
      These are small subsets of census data in a directory structure that
      matches the geographic level and tile name in
      <span class="Pa">DataTileGrid.json</span>. The structure is
    <p class="Pp"></p>
    <div class="Bd
      Bd-indent"><code class="Li">tiles/<var class="Va">level</var>/<var class="Va">tilename</var>/<var class="Va">category</var>.csv</code></div>
    <p class="Pp"><var class="Va">category</var> comes from
        <span class="Pa">content.json</span>. Every tile in
        <span class="Pa">DataTileGrid.json</span> gets its own complete set of
        category files.</p>
    <p class="Pp">These data tiles contain census data for a single category,
        and only include geographies from geojson that overlap the tile's
        bounding box.</p>
    <p class="Pp">Here is an example file named
        <span class="Pa">tiles/lad/ew/uk_armed_forces-001.csv</span>:</p>
    <div class="Bd Pp Bd-indent">
    <pre>
geography_code,uk_armed_forces-001
E06000001,4.1
E06000002,3
E06000003,4.9
E06000004,4
E06000005,4.9
E06000006,3.5
E06000007,3
E06000008,2.3
E06000009,4.2
    </pre>
    </div>
    <p class="Pp">In the heading row, the first heading is always
        &#x2018;<code class="Li">geography_code</code>&#x2019;, and the second
        heading is the category code.</p>
    <p class="Pp">See <a class="Sx" href="#SEE_ALSO">SEE ALSO</a> below for the
        location of downloadable metrics files.</p>
  </dd>
  <dt>breaks (directory)</dt>
  <dd>The <span class="Pa">breaks</span> directory holds ckmeans breakpoints and
      min/max values. The structure is
    <p class="Pp"></p>
    <div class="Bd
      Bd-indent"><code class="Li">breaks/<var class="Va">level</var>/<var class="Va">category</var>.json</code></div>
    .
    <p class="Pp"><var class="Va">level</var> is the geographic level
        &#x2018;<code class="Li">lad</code>&#x2019;,
        &#x2018;<code class="Li">lsoa</code>&#x2019;,
        &#x2018;<code class="Li">msoa</code>&#x2019;, or
        &#x2018;<code class="Li">oa</code>&#x2019;.
        <var class="Va">category</var> is the category code from
        <span class="Pa">content.json</span>. Each geographic level directory
        will have a file for each category in
        <span class="Pa">content.json</span>. Level directories will only be
        created when the corresponding geojson file is in
        <var class="Ar">indir</var>.</p>
    <p class="Pp">As an example, if <var class="Ar">indir</var> contains
        <span class="Pa">lad.geojson</span> and
        <span class="Pa">msoa.geojson</span>, and
        <span class="Pa">content.json</span> lists the
        &#x2018;<code class="Li">uk_armed_forces-001</code>&#x2019; and
        &#x2018;<code class="Li">uk_armed_forces-002</code>&#x2019; categories ,
        then the following four files will be produced:</p>
    <p class="Pp"></p>
    <div class="Bd-indent">
    <dl class="Bl-tag Bl-compact">
      <dt>lad/uk_armed_forces-001.json</dt>
      <dd style="width: auto;">&#x00A0;</dd>
      <dt>lad/uk_armed_forces-002.json</dt>
      <dd style="width: auto;">&#x00A0;</dd>
      <dt>msoa/uk_armed_forces-001.json</dt>
      <dd style="width: auto;">&#x00A0;</dd>
      <dt>msoa/uk_armed_forces-002.json</dt>
      <dd style="width: auto;">&#x00A0;</dd>
    </dl>
    </div>
    <p class="Pp">The metrics values for all geographies in each geographic
        level are included in the computations.</p>
    <p class="Pp">Here is an example output file
        <span class="Pa">breaks/lad/uk_armed_forces-001.json</span>:</p>
    <div class="Bd Pp Bd-indent">
    <pre>
{
    &quot;uk_armed_forces-001&quot;: {
        &quot;LAD&quot;: [
            1.5,
            2.7,
            3.9,
            6.2,
            11.1
        ],
        &quot;LAD_min_max&quot;: [
            0.4,
            11.1
        ]
    }
}
    </pre>
    </div>
  </dd>
  <dt>breaksCkmeans (directory)</dt>
  <dd>The <span class="Pa">breaksCkmeans</span> directory holds ckmeans
      breakpoints in a slightly different format than the ones in the
      <span class="Pa">breaks</span> directory.
      <span class="Pa">breaksCkmeans</span> files only hold the minimum value
      and the five breaks. This is how the same file used in the breaks example
      above looks in <span class="Pa">breaksCkmeans</span>:
    <div class="Bd Pp Bd-indent">
    <pre>
[
    0.4,
    1.5,
    2.7,
    3.9,
    6.2,
    11.1
]
    </pre>
    </div>
    <p class="Pp">The <span class="Pa">breaksCkmeans</span> directory structure
        is the same as <span class="Pa">breaks</span>.</p>
  </dd>
  <dt>geoLookup.json</dt>
  <dd>The <span class="Pa">geoLookup.json</span> file is a listing of all
      geographies found in the geojson files. It is a json array of geographies
      that look like this:
    <div class="Bd Pp Bd-indent">
    <pre>
{
    &quot;en&quot;: &quot;Hartlepool&quot;,
    &quot;geoType&quot;: &quot;LAD&quot;,
    &quot;geoCode&quot;: &quot;E06000001&quot;
}
    </pre>
    </div>
  </dd>
</dl>
</section>
<section class="Ss">
<h2 class="Ss" id="Calculating_Ratios"><a class="permalink" href="#Calculating_Ratios">Calculating
  Ratios</a></h2>
<p class="Pp">When <code class="Fl">-R</code> is given on the command line, the
    output data tiles will contain ratios instead of values taken directly from
    the metrics files. The ratio is the metric value divided by the total for
    that geography.</p>
<p class="Pp">For example, if a line in the metrics file looks like this:</p>
<div class="Bd Pp Bd-indent">
<pre>
GeographyCode,QS402EW0001,QS402EW0012,QS402EW0013,QS402EW0014
E06000001,12,3,6,3
</pre>
</div>
<p class="Pp">the ratio for &#x2018;<code class="Li">QS402EW0012</code>&#x2019;
    will be 3/12 (0.25). Data tiles for the geography code
    &#x2018;<code class="Li">E06000001</code>&#x2019; and category
    &#x2018;<code class="Li">QS402EW0012</code>&#x2019; will have the value 0.25
    (its ratio), not 3 (its value).</p>
<p class="Pp">In order for this to work, category codes must fit a certain
    convention so <code class="Nm">mktiles2</code> knows which column is the
    totals column. Because the <code class="Fl">-R</code> functionality was used
    during development with 2011 data, the convention follows 2011 category
    codes. The convention for category codes is:</p>
<div class="Bd Pp Bd-indent">
<pre>
<var class="Va">upper-case</var>+<var class="Va">digits</var>+<var class="Va">upper-case</var>+<var class="Va">final-digits</var>
</pre>
</div>
<p class="Pp">Totals columns are those where <var class="Va">final-digits</var>
    has a value of 1, with any number of leading zeros. For example,
    &#x2018;<code class="Li">QS402EW0001</code>&#x2019; is a totals category
    because the last numeric part has a value of 1.</p>
</section>
<section class="Ss">
<h2 class="Ss" id="Operation"><a class="permalink" href="#Operation">Operation</a></h2>
<p class="Pp">These are the processing steps <code class="Nm">mktiles2</code>
    takes when producing output files.</p>
<ol class="Bl-enum">
  <li>Load <span class="Pa">content.json</span>
    <p class="Pp">Category codes and names are extracted from
        <span class="Pa">content.json</span>. If <code class="Fl">-C</code> is
        used, then only the categories in the given classification will be
        extracted.</p>
    <p class="Pp">If <code class="Fl">-M</code> is used, then an internal table
        is set up to map category names to codes.</p>
  </li>
  <li>Load the grid file
    <p class="Pp">Tiles from <span class="Pa">DataTileGrid.json</span> are
        loaded.</p>
  </li>
  <li>Set up notional spreadsheet
    <p class="Pp">An internal table is set up with rows for geographies and
        columns for each category from <span class="Pa">content.json</span>.
        This table will hold fake data, values loaded from metrics files, or
        ratios calculated from metrics files.</p>
  </li>
  <li>Load metrics files
    <p class="Pp">If we are not generating fake data, then metrics files are
        loaded. As each file is loaded, cells in the notional spreadsheet are
        populated with values from the file. Only cells from categories that
        have been extracted from <span class="Pa">content.json</span> are
        loaded. Extra columns are ignored.</p>
  </li>
  <li>Load geojson files
    <p class="Pp">Optional MSOA renames and LAD recodes are applied while the
        geojson is loaded.</p>
    <p class="Pp">A bounding box is calculated for each feature that doesn't
        already have one.</p>
  </li>
  <li>Generate geoLookup.json</li>
  <li>Generate fake data
    <p class="Pp">If <code class="Fl">-F</code> was given, fake data is
        generated for every cell in the notional spreadsheet. Each cell gets a
        random floating point value between 0 and 1.</p>
  </li>
  <li>Calculate ratios If <code class="Fl">-R</code> was given, then the cell
      contents of non-totals cells are recalculated as the ratio of their
      original value and the total value. See
      <a class="Sx" href="#Calculating_Ratios">Calculating Ratios</a>
    above.</li>
  <li>Generate data tiles
    <p class="Pp">Data tiles are generated based on the bounding boxes from the
        Grid file and the bounding boxes of features in the geojson files.</p>
  </li>
  <li>Generate breaks files</li>
</ol>
</section>
</section>
<section class="Sh">
<h1 class="Sh" id="FILES"><a class="permalink" href="#FILES">FILES</a></h1>
<section class="Ss">
<h2 class="Ss" id="Input_files"><a class="permalink" href="#Input_files">Input
  files</a></h2>
<dl class="Bl-tag Bl-compact">
  <dt>DataTileGrid.json</dt>
  <dd style="width: auto;">&#x00A0;</dd>
  <dt>lad.geojson</dt>
  <dd style="width: auto;">&#x00A0;</dd>
  <dt>lsoa.geojson</dt>
  <dd style="width: auto;">&#x00A0;</dd>
  <dt>msoa.geojson</dt>
  <dd style="width: auto;">&#x00A0;</dd>
  <dt>oa.geojson</dt>
  <dd style="width: auto;">&#x00A0;</dd>
  <dt>msoa-names.csv</dt>
  <dd style="width: auto;">&#x00A0;</dd>
  <dt>recode-lads.csv</dt>
  <dd style="width: auto;">&#x00A0;</dd>
  <dt>content.json</dt>
  <dd style="width: auto;">&#x00A0;</dd>
  <dt>*.csv</dt>
  <dd style="width: auto;">&#x00A0;</dd>
</dl>
</section>
<section class="Ss">
<h2 class="Ss" id="Output_files"><a class="permalink" href="#Output_files">Output
  files</a></h2>
<dl class="Bl-tag Bl-compact">
  <dt>tiles/level/tilename/category.csv</dt>
  <dd style="width: auto;">&#x00A0;</dd>
  <dt>breaks/level/category.json</dt>
  <dd style="width: auto;">&#x00A0;</dd>
  <dt>breaksCkmeans/level/category.json</dt>
  <dd style="width: auto;">&#x00A0;</dd>
  <dt>geoLookup.json</dt>
  <dd style="width: auto;">&#x00A0;</dd>
</dl>
</section>
</section>
<section class="Sh">
<h1 class="Sh" id="EXIT_STATUS"><a class="permalink" href="#EXIT_STATUS">EXIT
  STATUS</a></h1>
<p class="Pp">The <code class="Nm">mktiles2</code> utility exits&#x00A0;0 on
    success, and&#x00A0;&gt;0 if an error occurs.</p>
</section>
<section class="Sh">
<h1 class="Sh" id="SEE_ALSO"><a class="permalink" href="#SEE_ALSO">SEE
  ALSO</a></h1>
<p class="Pp"><a class="Lk" href="https://houseofcommonslibrary.github.io/msoanames/">House
    of Commons Library MSOA Names</a></p>
<p class="Pp">geojson files may be downloaded from the
    <a class="Lk" href="https://geoportal.statistics.gov.uk">ONS Open Geography
    Portal</a>. For LSOA, MSOA and OA files, go to &quot;Boundaries&quot; -&gt;
    &quot;Census Boundaries&quot; and then select one of:</p>
<table class="Bl-column Bd-indent">
  <tr>
    <td>LSOA</td>
    <td>Lower Layer Super Output Areas</td>
  </tr>
  <tr>
    <td>MSOA</td>
    <td>Middle Layer Super Output Areas</td>
  </tr>
  <tr>
    <td>OA</td>
    <td>Output Areas</td>
  </tr>
</table>
<p class="Pp">For LAD files, go to Boundaries -&gt; Administrative Boundaries
    -&gt; Local Authority Districts.</p>
<p class="Pp">2011 metrics files may be downloaded from
    <a class="Lk" href="https://www.nomisweb.co.uk">nomis</a>. Follow &quot;2011
    Data Catalogue&quot; -&gt; &quot;Bulk Download Products&quot; and then
    either &quot;Quick Statistics Bulk&quot; or &quot;Key Statistics Bulk&quot;.
    You can then download a zip file which contains several CSV files.</p>
<p class="Pp">2021 metrics files are not directly downloadable as yet.</p>
</section>
</div>
<table class="foot">
  <tr>
    <td class="foot-date">January 31, 2023</td>
    <td class="foot-os">macOS 12.6</td>
  </tr>
</table>
</body>
</html>
